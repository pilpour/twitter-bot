from config import EVENT_TYPES, TEAM_CODES

def format_price_change_tweets(price_changes):
    """
    ØªÙ†Ø³ÙŠÙ‚ ØªØºØ±ÙŠØ¯Ø§Øª ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
    
    Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª:
        price_changes (list): Ù‚Ø§Ø¦Ù…Ø© Ù…Ù† ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
    
    Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹:
        list: Ù‚Ø§Ø¦Ù…Ø© Ù…Ù† Ù†ØµÙˆØµ Ø§Ù„ØªØºØ±ÙŠØ¯Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ù†Ø´Ø±
    """
    if not price_changes:
        return []
    
    # ØªÙ‚Ø³ÙŠÙ… Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¥Ù„Ù‰ Ø§Ø±ØªÙØ§Ø¹Ø§Øª ÙˆØ§Ù†Ø®ÙØ§Ø¶Ø§Øª
    increases = [p for p in price_changes if p['direction'] == 'up']
    decreases = [p for p in price_changes if p['direction'] == 'down']
    
    tweets = []
    
    # Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø§Ø±ØªÙØ§Ø¹Ø§Øª
    if increases:
        current_tweet = "ğŸ”¼ Price Rises #FPL\n\n"
        
        for player in increases:
            line = f"ğŸ”¼ {player['name']} (#{player['team_code']}, {player['position']}) Â£{player['price']}m (+Â£{player['change']}m)\n"
            
            # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¯ Ø§Ù„Ø£Ø­Ø±Ù Ù„ØªÙˆÙŠØªØ±
            if len(current_tweet + line) > 280:
                tweets.append(current_tweet)
                current_tweet = "ğŸ”¼ Price Rises (Cont.) #FPL\n\n"
            
            current_tweet += line
        
        if current_tweet:
            tweets.append(current_tweet)
    
    # Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø§Ù†Ø®ÙØ§Ø¶Ø§Øª
    if decreases:
        current_tweet = "ğŸ”½ Price Falls #FPL\n\n"
        
        for player in decreases:
            line = f"ğŸ”½ {player['name']} (#{player['team_code']}, {player['position']}) Â£{player['price']}m (-Â£{player['change']}m)\n"
            
            # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¯ Ø§Ù„Ø£Ø­Ø±Ù Ù„ØªÙˆÙŠØªØ±
            if len(current_tweet + line) > 280:
                tweets.append(current_tweet)
                current_tweet = "ğŸ”½ Price Falls (Cont.) #FPL\n\n"
            
            current_tweet += line
        
        if current_tweet:
            tweets.append(current_tweet)
    
    return tweets

def format_live_match_update(match_data, is_final=False):
    """
    ØªÙ†Ø³ÙŠÙ‚ ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©
    
    Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª:
        match_data (dict): Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©
        is_final (bool): Ù‡Ù„ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ø§Ù†ØªÙ‡Øª
    
    Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹:
        str: Ù†Øµ Ø§Ù„ØªØºØ±ÙŠØ¯Ø©
    """
    if not match_data:
        return None
    
    # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©
    home_team = match_data.get('home_team', 'HOME')
    away_team = match_data.get('away_team', 'AWAY')
    home_score = match_data.get('home_score', 0)
    away_score = match_data.get('away_score', 0)
    
    status = "FT" if is_final else match_data.get('status', 'LIVE')
    
    tweet = f"{status}: {home_team} {home_score} - {away_score} {away_team} #FPL\n\n"
    
    if is_final:
        tweet += "Match Finished. Full #FPL points update to follow."
    
    return tweet

def format_live_event_tweet(event):
    """
    ØªÙ†Ø³ÙŠÙ‚ ØªØºØ±ÙŠØ¯Ø© Ù„Ø­Ø¯Ø« Ù…Ø¨Ø§Ø´Ø± (Ù‡Ø¯ÙØŒ Ø¨Ø·Ø§Ù‚Ø©ØŒ Ø¥Ù„Ø®)
    
    Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª:
        event (dict): Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¯Ø«
    
    Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹:
        str: Ù†Øµ Ø§Ù„ØªØºØ±ÙŠØ¯Ø©
    """
    if not event:
        return None
    
    # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ø­Ø¯Ø« Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
    event_type = event.get('event_type')
    event_prefix = EVENT_TYPES.get(event_type, '')
    
    # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙˆØ§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©
    player_name = event.get('player_name', '')
    team_code = event.get('team_code', '')
    home_team = event.get('home_team', '')
    away_team = event.get('away_team', '')
    home_score = event.get('home_score', 0)
    away_score = event.get('away_score', 0)
    minute = event.get('minute', 0)
    
    # Ø¥Ù†Ø´Ø§Ø¡ Ù†Øµ Ø§Ù„ØªØºØ±ÙŠØ¯Ø©
    tweet = f"{minute}' {home_team} {home_score}-{away_score} {away_team}\n\n"
    tweet += f"{event_prefix}{player_name} (#{team_code})\n\n"
    tweet += "#FPL"
    
    return tweet

def format_bonus_points_tweets(bonus_points):
    """
    ØªÙ†Ø³ÙŠÙ‚ ØªØºØ±ÙŠØ¯Ø§Øª Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª
    
    Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª:
        bonus_points (list): Ù‚Ø§Ø¦Ù…Ø© Ù…Ù† Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª Ù…ØµÙ†ÙØ© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©
    
    Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹:
        list: Ù‚Ø§Ø¦Ù…Ø© Ù…Ù† Ù†ØµÙˆØµ Ø§Ù„ØªØºØ±ÙŠØ¯Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ù†Ø´Ø±
    """
    if not bonus_points:
        return []
    
    tweets = []
    current_tweet = "ğŸ–ï¸ Bonus Points (Provisional) #FPL\n\n"
    
    for match in bonus_points:
        home_team = match.get('home_team', '')
        away_team = match.get('away_team', '')
        
        match_line = f"{home_team} vs {away_team}:\n"
        
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¯ Ø§Ù„Ø£Ø­Ø±Ù Ù„ØªÙˆÙŠØªØ±
        if len(current_tweet + match_line) > 240:  # Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù„Ù„Ø£Ø³Ù…Ø§Ø¡ ÙˆØ§Ù„Ù†Ù‚Ø§Ø·
            tweets.append(current_tweet)
            current_tweet = "ğŸ–ï¸ Bonus Points (Cont.) #FPL\n\n"
        
        current_tweet += match_line
        
        # Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙˆÙ†Ù‚Ø§Ø· Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡Ù…
        players = match.get('players', [])
        for player in players:
            player_line = f"â€¢ {player.get('points', 0)} pts - {player.get('name', '')} (#{player.get('team_code', '')})\n"
            
            # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¯ Ø§Ù„Ø£Ø­Ø±Ù Ù„ØªÙˆÙŠØªØ±
            if len(current_tweet + player_line) > 280:
                tweets.append(current_tweet)
                current_tweet = "ğŸ–ï¸ Bonus Points (Cont.) #FPL\n\n"
                current_tweet += f"{home_team} vs {away_team} (Cont.):\n"
            
            current_tweet += player_line
        
        current_tweet += "\n"
    
    if current_tweet:
        tweets.append(current_tweet)
    
    return tweets
